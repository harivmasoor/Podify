!function(){"use strict";!function(){let e=null;async function t(){try{const t=await fetch(`https://podify-backend.onrender.com/refresh_token?refresh_token=${localStorage.getItem("refresh_token")}`),a=await t.json();e=a.access_token,localStorage.setItem("access_token",e)}catch(e){console.error("Error refreshing token:",e)}}function a(e){const t=document.getElementById("searchResults");t.innerHTML="",e.forEach((e=>{const a=document.createElement("div");a.className="resultItem",a.dataset.id=e.id,a.dataset.type=e.type,a.dataset.name=e.name,a.dataset.image=e.image,a.innerHTML=`<img src="${e.image}" alt="${e.name}"/> ${e.name}`,a.addEventListener("click",n),t.appendChild(a)}))}async function n(n){const o=n.currentTarget.dataset.type,s=n.currentTarget.dataset.id;"artist"===o?await async function(n){const o=`https://api.spotify.com/v1/artists/${n}/top-tracks?market=US`,s={Authorization:`Bearer ${e}`,"Content-Type":"application/json"};try{let e=await fetch(o,{headers:s});401===e.status&&(await t(),e=await fetch(o,{headers:s}));a((await e.json()).tracks.map((e=>({type:"track",id:e.id,name:e.name,image:e.album.images[0].url}))))}catch(e){console.error("Error getting artist top tracks:",e)}}(s):"show"===o&&await async function(n){const o=`https://api.spotify.com/v1/shows/${n}/episodes?market=US&limit=5`,s={Authorization:`Bearer ${e}`,"Content-Type":"application/json"};try{let e=await fetch(o,{headers:s});401===e.status&&(await t(),e=await fetch(o,{headers:s}));a((await e.json()).items.map((e=>({type:"episode",id:e.id,name:e.name,image:e.images[0].url}))))}catch(e){console.error("Error getting show episodes:",e)}}(s)}let o=null;let s,r,i=new Promise((e=>{window.onSpotifyWebPlaybackSDKReady=()=>{e()}})),c=!1;function l(){c?r.pause().then((()=>{console.log("Paused Playback"),c=!1,document.getElementById("playPause").textContent="▶️"})):r.resume().then((()=>{console.log("Resumed Playback"),c=!0,document.getElementById("playPause").textContent="⏸️"}))}function d(){r.seek(r.getCurrentState().position-15e3)}function p(){r.seek(r.getCurrentState().position+15e3)}window.addEventListener("load",(()=>{const n=window.location.hash.substring(1),r=new URLSearchParams(n);if(r.has("access_token")){document.getElementById("loginButton").style.display="none",s=r.get("access_token");const n=r.get("token_type"),c=r.get("expires_in");document.getElementById("search-container").style.display="block",console.log({access_token:s,token_type:n,expires_in:c}),fetch("https://api.spotify.com/v1/me",{headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"}}).then((e=>e.json())).then((e=>{var t;t=e.display_name,document.getElementById("username").textContent=t})).catch((e=>{console.error("Error fetching user profile:",e)})),function(n){e=n;const o=document.getElementById("searchInput"),s=document.getElementById("searchResults");let r;o.addEventListener("input",(n=>{n.target.value?s.style.border="1px solid #ccc":s.style.border="none",clearTimeout(r),r=setTimeout((()=>{!async function(n){const o=`https://api.spotify.com/v1/search?q=${encodeURIComponent(n)}&type=artist,show,episode,track&limit=5`,s={Authorization:`Bearer ${e}`,"Content-Type":"application/json"};try{let e=await fetch(o,{headers:s});401===e.status&&(await t(),e=await fetch(o,{headers:s}));const n=await e.json();let r=[],i=[],c=[];n.tracks&&n.tracks.items&&(r=n.tracks.items.map((e=>({type:"track",id:e.id,name:e.name,image:e.album.images[0].url,popularity:e.popularity})))),n.artists&&n.artists.items&&(i=n.artists.items.map((e=>({type:"artist",id:e.id,name:e.name,image:e.images[0]?e.images[0].url:null,popularity:e.popularity})))),n.episodes&&n.episodes.items&&(c=n.episodes.items.map((e=>({type:"episode",id:e.id,name:e.name,image:e.images[0].url})))),r.sort(((e,t)=>t.popularity-e.popularity)),i.sort(((e,t)=>t.popularity-e.popularity));const l=[...r,...i,...c];return a(l),l}catch(e){return console.error("Error searching Spotify:",e),[]}}(n.target.value)}),500)}))}(s),async function(){return await i,window.Spotify?.Player?.isSupported()??!1}()?function(e){o=e,document.getElementById("searchResults").addEventListener("click",(e=>{e.target.classList.contains("resultItem")&&async function(e,t){const a={Authorization:`Bearer ${o}`,"Content-Type":"application/json"},n={context_uri:`spotify:${t}:${e}`};try{console.log("Attempting to play",n.context_uri);const o=await fetch("https://api.spotify.com/v1/me/player/play",{method:"PUT",headers:a,body:JSON.stringify(n)});if(!o.ok){const e=await o.json();throw console.error("Play response:",e),new Error(`Unable to play ${t}: ${o.statusText}`)}console.log(`Successfully started playing ${t} with ID: ${e}`)}catch(e){console.error("Error in web player:",e),function(e){console.error("Web Playback SDK error:",e),e.message.includes("Playback cannot be started from this context")?alert("Cannot play this item. Please choose another."):alert("Playback error. Please try again later.")}(e)}const s=Array.from(document.getElementById("searchResults").children).find((t=>t.dataset.id===e));s&&(document.getElementById("currentImage").src=s.dataset.image,document.getElementById("currentTitle").textContent=s.dataset.name)}(e.target.dataset.id,e.target.dataset.type)}))}(s):alert("Device not suitable for playback")}})),window.onSpotifyWebPlaybackSDKReady=()=>{r=new Spotify.Player({name:"Your Web Player Name",getOAuthToken:e=>{e(s)}}),r.addListener("player_state_changed",(e=>{console.log(e),c=!e.paused,document.getElementById("playPause").textContent=c?"⏸️":"▶️"})),r.addListener("ready",(e=>{let{device_id:t}=e;console.log("Ready with Device ID",t),fetch("https://api.spotify.com/v1/me/player",{method:"PUT",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"},body:JSON.stringify({device_ids:[t],play:!0})}).then((e=>{e.ok||console.error("Error setting active device:",e.statusText)}))})),r.connect()},document.getElementById("webPlayer").style.display="block",function(){document.getElementById("loginButton").addEventListener("click",(()=>{window.location.href="https://podify-backend.onrender.com/login"}));const e=document.getElementById("searchInput"),t=document.getElementById("searchResults");e.addEventListener("input",(()=>{e.value.length>0?t.style.display="block":t.style.display="none"})),e.addEventListener("focus",(e=>{e.preventDefault()})),document.getElementById("playPause").addEventListener("click",l),document.getElementById("rewind").addEventListener("click",d),document.getElementById("fastForward").addEventListener("click",p)}()}()}();
//# sourceMappingURL=main.js.map