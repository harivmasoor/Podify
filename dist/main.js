!function(){"use strict";!function(){let e=null;async function t(t,n){const a={Authorization:`Bearer ${e}`,"Content-Type":"application/json"};let o;o="track"===n||"episode"===n?{uris:[`spotify:${n}:${t}`]}:{context_uri:`spotify:${n}:${t}`};try{console.log("Attempting to play",o);const e=await async function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3;for(let a=0;a<n;a++)try{const o=await fetch(e,t);if(o.ok)return o;if(a===n-1)throw new Error("Max retries reached")}catch(e){console.error(`Attempt ${a+1} failed. Retrying...`),await new Promise((e=>setTimeout(e,2e3)))}}("https://api.spotify.com/v1/me/player/play",{method:"PUT",headers:a,body:JSON.stringify(o)});if(!e.ok){const t=await e.json();throw console.error("Play response:",t),new Error(`Unable to play ${n}: ${e.statusText}`)}console.log(`Successfully started playing ${n} with ID: ${t}`)}catch(e){console.error("Error in web player:",e),function(e){console.error("Web Playback SDK error:",e),e.message.includes("Max retries reached")?alert("There seems to be a connection issue with Spotify. Please try again in a few moments."):e.message.includes("Playback cannot be started from this context")?alert("Cannot play this item. Please choose another."):alert("Playback error. Please try again later.")}(e)}const s=Array.from(document.getElementById("searchResults").children).find((e=>e.dataset.id===t));s&&(document.getElementById("currentImage").src=s.dataset.image,document.getElementById("currentTitle").textContent=s.dataset.name)}let n,a,o,s=new Promise((e=>{window.onSpotifyWebPlaybackSDKReady=()=>{e()}})),r=null;async function i(){try{const e=await fetch(`https://podify-backend.onrender.com/refresh_token?refresh_token=${localStorage.getItem("refresh_token")}`),t=await e.json();r=t.access_token,localStorage.setItem("access_token",r)}catch(e){console.error("Error refreshing token:",e)}}function c(e){const t=document.getElementById("searchResults");t.innerHTML="";const n=e.filter((e=>"episode"===e.type)),a=e.filter((e=>"track"===e.type)),o=e.filter((e=>"artist"===e.type)),s=e.filter((e=>"show"===e.type));if(o.length>0){const e=document.createElement("h2");e.textContent="Geniuses",t.appendChild(e),o.forEach((e=>l(e,t)))}if(s.length>0){const e=document.createElement("h2");e.textContent="Moguls",t.appendChild(e),s.forEach((e=>l(e,t)))}if(n.length>0){const e=document.createElement("h2");e.textContent="Pods",t.appendChild(e),n.forEach((e=>l(e,t)))}if(a.length>0){const e=document.createElement("h2");e.textContent="Bangers",t.appendChild(e),a.forEach((e=>l(e,t)))}}function l(e,t){const n=document.createElement("div");n.className="resultItem",n.dataset.id=e.id,n.dataset.type=e.type,n.dataset.name=e.name,n.dataset.image=e.image,n.innerHTML=`<img src="${e.image}" alt="${e.name}"/> ${e.name}`,n.addEventListener("click",d),t.appendChild(n)}async function d(e){const n=e.currentTarget.dataset.type,a=e.currentTarget.dataset.id;"artist"===n?await async function(e){const t=`https://api.spotify.com/v1/artists/${e}/top-tracks?market=US`,n={Authorization:`Bearer ${r}`,"Content-Type":"application/json"};try{let e=await fetch(t,{headers:n});401===e.status&&(await i(),e=await fetch(t,{headers:n}));c((await e.json()).tracks.map((e=>({type:"track",id:e.id,name:e.name,image:e.album.images[0].url}))))}catch(e){console.error("Error getting artist top tracks:",e)}}(a):"show"===n?await async function(e){const t=`https://api.spotify.com/v1/shows/${e}/episodes?market=US&limit=10`,n={Authorization:`Bearer ${r}`,"Content-Type":"application/json"};try{let e=await fetch(t,{headers:n});401===e.status&&(await i(),e=await fetch(t,{headers:n}));c((await e.json()).items.map((e=>({type:"episode",id:e.id,name:e.name,image:e.images[0].url}))))}catch(e){console.error("Error getting show episodes:",e)}}(a):"track"!==n&&"episode"!==n||t(a,n)}let m=!1;function p(){m?o.pause().then((()=>{console.log("Paused Playback"),m=!1,document.getElementById("playPause").textContent="▶️",clearInterval(n)})):o.resume().then((()=>{console.log("Resumed Playback"),m=!0,document.getElementById("playPause").textContent="⏸️",n=setInterval(g,1e3)}))}function u(){o.getCurrentState().then((e=>{if(e){const t=Math.max(e.position-15e3,0);o.seek(t).then((()=>{console.log("Rewound 15 seconds!")}))}}))}function y(){o.getCurrentState().then((e=>{if(e){const t=e.position+15e3;o.seek(t).then((()=>{console.log("Fast-forwarded 15 seconds!")}))}}))}function h(e){const t=Math.floor(e/1e3),n=t%60;return`${Math.floor(t/60)}:${n<10?"0":""}${n}`}function g(){o.getCurrentState().then((e=>{if(e){const t=e.position;document.getElementById("seekBar").value=t,document.getElementById("currentTime").textContent=h(t)}}))}window.addEventListener("load",(()=>{const n=window.location.hash.substring(1),o=new URLSearchParams(n);if(o.has("access_token")){document.getElementById("loginButton").style.display="none",a=o.get("access_token");const n=o.get("token_type"),l=o.get("expires_in");document.getElementById("search-container").style.display="block",console.log({access_token:a,token_type:n,expires_in:l}),fetch("https://api.spotify.com/v1/me",{headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}}).then((e=>e.json())).then((e=>{var t;t=e.display_name,document.getElementById("username").textContent=t})).catch((e=>{console.error("Error fetching user profile:",e)})),function(e){r=e;const t=document.getElementById("searchInput"),n=document.getElementById("searchResults");let a;t.addEventListener("input",(e=>{e.target.value?n.style.border="1px solid #ccc":n.style.border="none",clearTimeout(a),a=setTimeout((()=>{!async function(e){const t=`https://api.spotify.com/v1/search?q=${encodeURIComponent(e)}&type=artist,show,episode,track&limit=5`,n={Authorization:`Bearer ${r}`,"Content-Type":"application/json"};try{let e=await fetch(t,{headers:n});401===e.status&&(await i(),e=await fetch(t,{headers:n}));const a=await e.json();let o=[],s=[],r=[],l=[];a.tracks&&a.tracks.items&&(o=a.tracks.items.map((e=>({type:"track",id:e.id,name:e.name,image:e.album.images[0].url,popularity:e.popularity})))),a.artists&&a.artists.items&&(s=a.artists.items.map((e=>({type:"artist",id:e.id,name:e.name,image:e.images[0]?e.images[0].url:null,popularity:e.popularity})))),a.episodes&&a.episodes.items&&(r=a.episodes.items.map((e=>({type:"episode",id:e.id,name:e.name,image:e.images[0].url})))),a.shows&&a.shows.items&&l.push(...a.shows.items.map((e=>({type:"show",id:e.id,name:e.name,image:e.images[0]?.url||""})))),a.artists&&a.artists.items&&s.push(...a.artists.items.map((e=>({type:"artist",id:e.id,name:e.name,image:e.images[0]?.url||""})))),o.sort(((e,t)=>t.popularity-e.popularity)),s.sort(((e,t)=>t.popularity-e.popularity));const d=[...l,...o,...s,...r];return c(d),d}catch(e){return console.error("Error searching Spotify:",e),[]}}(e.target.value)}),500)}))}(a),async function(){return await s,window.Spotify?.Player?.isSupported()??!1}()?function(n){e=n,document.getElementById("searchResults").addEventListener("click",(e=>{e.target.classList.contains("resultItem")&&t(e.target.dataset.id,e.target.dataset.type)}))}(a):alert("Device not suitable for playback")}})),window.onSpotifyWebPlaybackSDKReady=()=>{o=new Spotify.Player({name:"Your Web Player Name",getOAuthToken:e=>{e(a)}}),o.addListener("player_state_changed",(e=>{if(console.log(e),e){const t=e.track_window.current_track.duration_ms,n=e.position;document.getElementById("seekBar").max=t,document.getElementById("seekBar").value=n,document.getElementById("currentTime").textContent=h(n),document.getElementById("totalTime").textContent=h(t)}m=!e.paused,document.getElementById("playPause").textContent=m?"⏸️":"▶️"})),o.addListener("ready",(e=>{let{device_id:t}=e;console.log("Ready with Device ID",t),n=setInterval(g,1e3),fetch("https://api.spotify.com/v1/me/player",{method:"PUT",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify({device_ids:[t],play:!0})}).then((e=>{e.ok||console.error("Error setting active device:",e.statusText)}))})),o.connect()},document.getElementById("webPlayer").style.display="block",document.getElementById("seekBar").addEventListener("input",(e=>{const t=e.target.value;o.seek(t).then((()=>{console.log(`Moved to ${t} ms`)}))})),document.getElementById("currentTime").textContent=h(0),document.getElementById("totalTime").textContent=h(0),function(){document.getElementById("loginButton").addEventListener("click",(()=>{window.location.href="https://podify-backend.onrender.com/login"}));const e=document.getElementById("searchInput"),t=document.getElementById("searchResults");e.addEventListener("input",(()=>{e.value.length>0?t.style.display="block":t.style.display="none"})),e.addEventListener("focus",(e=>{e.preventDefault()})),document.getElementById("playPause").addEventListener("click",p),document.getElementById("rewind").addEventListener("click",u),document.getElementById("fastForward").addEventListener("click",y)}()}()}();
//# sourceMappingURL=main.js.map